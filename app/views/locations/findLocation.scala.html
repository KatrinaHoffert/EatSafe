@import general._
@import models._
@import controllers._

@**
 * This page is intended to allow users to get to a specific location page via a typeahead
 * search bar. When a location is selected, the ID is set in a hidden field, which is
 * then submitted to the JavaScript function that formats the URL and directs the browser.
 *
 * locations: A list of all the locations in the municipality specified.
 *@
@(locations: Seq[SlimLocation])

@scripts = {
  <script>
    var places = @Html(util.TypeConversions.slimLocationsToJson(locations).toString);
     
    $("#location").typeahead({
      minLength: 1,
      maxItem: 8,
      order: "asc",
      hint: true,
      display: "name",
      template: '<span>{{name}} {{address}}</span>',
      source: {
        data: places
      },
      callback: {
        onClick: function (node, a, obj, e) {
          $("#findLocationID").val(obj.id);
        }
      }
    });

    function viewLocation() {
      var locationID = $("#findLocationID").val();
      var destURL = "/view/" + locationID;
      window.location.assign(destURL);
    }
  </script>
}

@mainBody(title = Messages("locations.selectLocation.title"), moreScripts = scripts) {
  @headingSmall(Messages("general.applicationName"))
  <h2>@Messages("locations.selectLocation.prompt")</h2>
  
  <div class="typeahead-container">
    <div class="typeahead-field">

      <span class="typeahead-query">
        <input id="location" onkeypress="if (event.keyCode==13){viewLocation()}"
               name="location[query]" type="search" placeholder="Search" autocomplete="off">
      </span>
      <span class="typeahead-button">
        <button type="submit" id="submitButton" onclick="viewLocation()">
          <i class="search-icon"></i>
        </button>
      </span>
    </div>
  </div>
  
  <input type="hidden" id="findLocationID" value="0"></input>
}
